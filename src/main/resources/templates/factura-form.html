<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="UTF-8">
  <title>Nueva Factura</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" th:href="@{/css/estilos.css}">

</head>
<body>
  <div class="sidebar">
    <img src="/img/logo.png" alt="Logo MXG">
    <a href="/" class="btn">INICIO</a>
    <a href="#" class="btn">CATÁLOGO</a>
    <a href="/usuarios" class="btn">USUARIOS</a>
  </div>

  <div class="main-content">
    <div class="form-container">
      
        <h4 class="form-title">
          <i class="fa-solid fa-id-card"></i> CREAR FACTURA
        </h4>

        <form th:action="@{/facturas/guardar}" method="post" th:object="${factura}">
        <div class="row">
          <div class="col-md-6">
            <label class="form-icon-label"> <i class="fa-solid fa-location-dot"></i>Ciudad:</label>
            <select class="form-select" th:field="*{ciudad.id}">
              <option value="">Seleccione</option>
              <option th:each="c : ${ciudades}" th:value="${c.id}" th:text="${c.nombre}"></option>
            </select>

            <label class="form-icon-label">
              <i class="fa-solid fa-calendar-day"></i> Fecha de Venta
            </label>
            <input type="date" th:field="*{fechaVenta}" class="form-control" required>

            
            <label class="form-icon-label">Debe a:</label>
            <span id="empresa" th:text="${empresa.nombreEmpresa + ' - NIT: ' + empresa.nitEmpresa}"></span>
            <input type="hidden" name="empresa.nitEmpresa" th:value="${empresa.nitEmpresa}" />
          </div>

          <div class="col-md-6">
            <label class="form-icon-label"><i class="fa-solid fa-user"></i> Cliente</label>
              <select id="clienteSelect" class="form-select" th:field="*{usuario.documento}" onchange="actualizarDocumento()">
                <option value="">Seleccione</option>
                <option th:each="u : ${usuarios}"
                        th:value="${u.documento}"
                        th:data-tipo="${u.tipoUsuario}"
                        th:data-doc="${u.documento}"
                        th:text="${u.nombre + ' ' + u.primerApellido}">
                </option>
              </select>
                
              <span id="labelDocumento" class="fw-bold ms-2"></span>

              <label class="form-icon-label"><i class="fa-solid fa-align-left"></i> Descripción Venta</label>
              <input type="text" class="form-control" th:field="*{descripcionVenta}" required>
          </div>
        </div>

        
          <div class="d-flex justify-content-between align-items-center my-3">
            <button type="button" class="btn btn-outline-danger btn-xl" onclick="eliminarFila()">-</button>
            <h5 class="m-0">Detalles de la Factura</h5>
            <button type="button" class="btn btn-outline-success btn-sm" onclick="agregarFila()">+</button>
          </div>

          <table id="tablaDetalle" class="table tabla-usuarios">
            <thead class="table-light">
              <tr>
                <th>Producto</th>
                <th>Terminado</th>
                <th>Cantidad</th>
                <th>Valor</th>
                <th>Descripción</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <select class="form-select" name="productoId">
                    <option value="">Seleccione un producto</option>
                    <option th:each="p : ${productos}" th:value="${p.id}" th:data-nombre="${p.nombre}" th:text="${p.nombre}"></option>
                  </select>
                </td>
                <td>
                  <select name="terminadoId" class="form-select select-terminado">
                    <option value="">Seleccione un terminado</option>
                  </select>
                </td>
                <td>
                  <div class="input-group justify-content-center align-items-center">
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="disminuir(this)">-</button>
                    <input type="number" class="form-control text-center" name="cantidad" value="1" min="1" required style="max-width: 70px; margin-bottom: 0px;">
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="aumentar(this)">+</button>
                  </div>
                </td>
                <td>
                  <input type="number" class="form-control" name="valor" step="0.01" required>
                </td>
                <td>
                  <input type="text" class="form-control" name="descripcion">
                </td>
              </tr>
            </tbody>
          </table>

          <div class="text-end fw-bold fs-5 mt-3">
            TOTAL: $<span id="totalFactura">0</span>
          </div>

          <input type="hidden" id="inputTotalFactura" name="totalFactura">

          <div class="col-12 d-flex justify-content-end">
              <button type="submit" class="custom-btn">
                  <i class="fa-solid fa-save"></i> GUARDAR
              </button>
          </div>
        </form>
    </div>
  </div>

  <script th:src="@{/js/validaciones.js}"></script>
</body>
</html>
